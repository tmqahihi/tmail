    <script>
        const emailEl = document.getElementById("emailValue");
        const btnGenerate = document.getElementById("btnGenerate");
        const btnCopy = document.getElementById("btnCopy");
        const timeDisplay = document.getElementById("timeDisplay");
        const inboxList = document.getElementById("inboxList");
        const inboxCount = document.getElementById("inboxCount");
        const toast = document.getElementById("toast");
        const yearSpan = document.getElementById("yearSpan");

        const BASE_URL = "https://www.1secmail.com/api/v1/";

        let currentEmail = null;
        let currentLogin = null;
        let currentDomain = null;
        let inboxTimer = null;

        yearSpan.textContent = new Date().getFullYear();

        function updateClock() {
            const now = new Date();
            const pad = (n) => String(n).padStart(2, "0");
            const timeStr =
                pad(now.getHours()) +
                ":" +
                pad(now.getMinutes()) +
                ":" +
                pad(now.getSeconds());
            const dateStr =
                pad(now.getDate()) +
                "/" +
                pad(now.getMonth() + 1) +
                "/" +
                now.getFullYear();
            timeDisplay.textContent = `${timeStr} · ${dateStr}`;
        }
        setInterval(updateClock, 1000);
        updateClock();

        function showToast(msg = "Email đã được sao chép vào clipboard!") {
            if (msg) {
                toast.querySelector("div:last-child").textContent = msg;
            }
            toast.classList.add("show");
            setTimeout(() => toast.classList.remove("show"), 2000);
        }

        async function copyEmail() {
            if (!currentEmail) return;
            try {
                if (navigator.clipboard?.writeText) {
                    await navigator.clipboard.writeText(currentEmail);
                } else {
                    const temp = document.createElement("textarea");
                    temp.value = currentEmail;
                    document.body.appendChild(temp);
                    temp.select();
                    document.execCommand("copy");
                    document.body.removeChild(temp);
                }
                showToast();
            } catch (e) {
                alert("Không sao chép được, bạn copy tay giúp mình nhé!");
            }
        }

        async function apiRequest(params) {
            const url = new URL(BASE_URL);
            Object.entries(params).forEach(([k, v]) =>
                url.searchParams.append(k, v)
            );
            const res = await fetch(url.toString());
            if (!res.ok) throw new Error("API error");
            return res.json();
        }

        async function generateEmail() {
            try {
                // Tạo 1 email random
                const list = await apiRequest({
                    action: "genRandomMailbox",
                    count: 1,
                });
                const email = Array.isArray(list) ? list[0] : String(list);
                currentEmail = email;
                const [login, domain] = email.split("@");
                currentLogin = login;
                currentDomain = domain;

                emailEl.textContent = email;

                // Reset inbox & bắt đầu reload
                renderInbox([]);
                if (inboxTimer) clearInterval(inboxTimer);
                await loadInbox();
                inboxTimer = setInterval(loadInbox, 5000);
            } catch (e) {
                console.error(e);
                showToast("Lỗi tạo email, thử lại sau.");
            }
        }

        async function loadInbox() {
            if (!currentLogin || !currentDomain) return;
            try {
                const messages = await apiRequest({
                    action: "getMessages",
                    login: currentLogin,
                    domain: currentDomain,
                });
                renderInbox(Array.isArray(messages) ? messages : []);
            } catch (e) {
                console.error(e);
            }
        }

        async function readMessage(id) {
            try {
                const msg = await apiRequest({
                    action: "readMessage",
                    login: currentLogin,
                    domain: currentDomain,
                    id: id,
                });
                if (!msg) return;
                alert(
                    "Từ: " +
                        msg.from +
                        "\nChủ đề: " +
                        msg.subject +
                        "\n\n" +
                        (msg.textBody || msg.body || "[Không có nội dung]")
                );
            } catch (e) {
                console.error(e);
            }
        }

        function renderInbox(items) {
            inboxList.innerHTML = "";
            inboxCount.textContent = items.length;

            if (!items.length) {
                inboxList.innerHTML =
                    '<div class="inbox-empty">Chưa có email nào. Gửi thử 1 mail đến địa chỉ ở bên trái rồi bấm lại "Tạo email mới" hoặc chờ 5 giây để reload.</div>';
                return;
            }

            items
                .slice()
                .reverse()
                .forEach((m) => {
                    const div = document.createElement("div");
                    div.className = "msg-item";
                    div.innerHTML = `
            <div class="msg-top">
              <div>
                <div class="msg-from">${m.from}</div>
                <div class="msg-subject">${m.subject || "(Không có chủ đề)"}</div>
              </div>
              <div style="text-align:right;display:flex;flex-direction:column;gap:4px;align-items:flex-end;">
                <div class="msg-time">${m.date || ""}</div>
                <div class="msg-badge">INBOX</div>
              </div>
            </div>
          `;
                    div.addEventListener("click", () => readMessage(m.id));
                    inboxList.appendChild(div);
                });
        }

        btnGenerate.addEventListener("click", generateEmail);
        btnCopy.addEventListener("click", copyEmail);

        // Tự tạo 1 email khi mở trang
        generateEmail();
    </script>
</body>
</html>
